# 兑换码生成系统 Flutter APP 开发指南

## 📋 文档说明

本文档是兑换码生成系统 Flutter APP 的完整开发指南，包含所有设计细节、技术规范和实现要求。

**目标读者**：AI 大模型、Flutter 开发者  
**文档版本**：v1.0.0  
**最后更新**：2025-11-19

---

## 📖 目录

1. 项目概述
2. 开发目标
3. UI/UX 设计规范
4. 页面功能设计
5. 技术选型
6. 技术架构
7. 后端接口说明
8. 开发规范
9. 实现细节

---

## 1. 项目概述

### 1.1 项目背景
- 给用户使用的兑换码生成系统 APP
- 用于生成植物大战僵尸2中植物和植物装扮的兑换码
- 用户规模：目前估计小于100人
- 使用环境：主要手机，偶尔电脑
- 不上线应用商店

### 1.2 核心价值

- 实现让用户使用卡密登录的功能，不登录不能使用内部的兑换码生成系统
- 可生成单个植物和单个植物装扮兑换码
- 可生成多个植物的兑换码，支持按照不同的模式选择多个植物，如从20个植物中选择16个、从16个植物中选择8个、从10个植物中选择5个、从40个植物中选择3个
- 可生成多个植物装扮的兑换码，支持从12个植物装扮中任意选择，如支持从12个植物装扮中选择1个进行生成、支持从12个植物装扮中选择2个或3个进行生成，以此类推
- 跨平台支持（Android、iOS、Web）

---

## 2. 开发目标

### 2.1 主要目标
1. 功能完整性：实现核心的登录功能和所有的植物/植物装扮兑换码生成功能
2. 用户体验：流畅、直观、现代化的界面
3. 性能优化：快速响应、低内存占用
4. 跨平台支持：一套代码支持多端
5. 可维护性：清晰的代码结构

### 2.2 非目标
- 不需要离线模式
- 不需要多语言支持
- 不需要复杂的权限管理
- 不需要应用商店上架

---

## 3. UI/UX 设计规范

### 3.1 设计系统

#### Material Design 3
- 采用 Google 最新的 Material Design 3 设计规范
- 使用 Flutter 3.x 的 Material 3 组件
- 遵循 Material You 设计语言

#### 主题系统
- **动态配色**：基于 Material You 的动态配色系统
- **种子颜色**：天蓝色（Sky-blue）作为主色调
- **配色库**：使用 `material_color_utilities` 生成完整配色方案

### 3.2 视觉特征

#### 圆角设计
- **Superellipse（超椭圆）圆角**：比传统圆角更具现代感
- 应用于所有卡片、按钮、输入框
- 圆角半径：12-16dp

#### 布局风格
- **卡片式布局**：主要内容使用卡片承载
- **统一组件**：使用 CommonCard 组件统一风格
- **卡片类型**：
  - `plain`（轮廓）：透明背景 + 边框
  - `filled`（填充）：填充背景色

#### 间距系统
- 基础单位：4dp
- 常用间距：8dp、12dp、16dp、24dp、32dp
- 卡片内边距：16dp
- 卡片外边距：12dp

### 3.3 图标系统

#### 图标库
- **主要图标库**：Material Icons
- **图标风格**：Outlined（线性）为主，Filled（填充）为辅
- **图标大小**：24dp（标准）、20dp（小）、32dp（大）

#### 核心图标定义
- 主界面的标题：`Icons.main_screen_outlined`
- 单植物/单装扮：`Icons.plant_costume_outlined`
- 多植物：`Icons.multi_plant_outlined`
- 多装扮：`Icons.multi_costume_outline`
- 生成：`Icons.generate_outline`

### 3.4 颜色系统

#### Material You 配色
- **种子颜色**：天蓝色 Color(0xFF3498db)
- **配色方案**：基于种子颜色自动生成
  - Primary（主色）
  - Secondary（次要色）
  - Tertiary（第三色）
  - Error（错误色）
  - Surface（表面色）
  - Background（背景色）

### 3.5 排版系统

#### 字体
- **系统默认字体**：使用平台默认字体
- **字体大小**：
  - 标题1：24sp（粗体）
  - 标题2：20sp（粗体）
  - 标题3：16sp（中粗）
  - 正文：14sp（常规）
  - 说明文字：12sp（常规）
  - 按钮文字：14sp（中粗）

#### 文字颜色
- 主要文字：`onSurface`（高对比度）
- 次要文字：`onSurface.withOpacity(0.6)`
- 禁用文字：`onSurface.withOpacity(0.38)`

---

## 4. 页面功能设计

### 4.1 应用结构

#### 顶部 AppBar
- **样式**：Material 3 AppBar
- **左侧**：页面标题
- **不使用**：侧边抽屉、更多菜单

### 4.2 页面1：主界面（MainScreen）

#### 页面标识
- **路由名称**：`/mainScreen`
- **页面标题**：礼包兑换码生成
- **导航图标**：`Icons.main_screen_outlined`

#### 页面布局
```
+-------------------------------------------------+
|  🎁 礼包兑换码生成                              | <-- AppBar
+-------------------------------------------------+
|                                                 |
|  .-------------------------------------------.  |
|  | [图标]单植物/装扮礼包                 [>] |   | <-- 单植物/装扮卡片
|  |       单个植物生成礼包                    |   |     
|  '-------------------------------------------'  |
|                                                 | 
|  .-------------------------------------------.  |
|  |  [图标]多植物礼包                      [>] |  | <-- 多植物卡片
|  |       从多个植物中选择组合生成              |  |     
|  '-------------------------------------------'  |
|                                                 | 
|  .-------------------------------------------.  |
|  |  [图标]多装扮礼包                      [>] |  | <-- 多装扮卡片
|  |       12个超级装扮任意选择                 |   |    
|  '-------------------------------------------'  |
|                                                 |
|                                                 |
|                                                 |
|                    ✨                           | 
|                                                 |     
|            选择礼包名称开始生成                   |
|                                                 |
|                                                 |
|                                                 |
'-------------------------------------------------'
```

#### 功能详情

**1. 单植物/装扮卡片**

- **交互**：点击该卡片进入单植物/装扮界面
- **卡片类型**：plain

**2. 多植物卡片**

- **交互**：点击后进入多植物界面
- **卡片类型**：plain

**3. 多装扮卡片**

- **交互**：点击后进入多装扮界面
- **卡片类型**：plain

---

### 4.3 页面2：单植物/装扮界面（Plant）

#### 页面标识
- **路由名称**：`/plant`
- **页面标题**：单植物/装扮礼包
- **导航图标**：`Icons.plant_costume_outlined`

#### 页面布局
```
+-------------------------------------------------------+
|  [<-]          [图标] 单植物/装扮礼包                     | <-- AppBar
+-------------------------------------------------------+
| 													|
|  +-------------------------------------------------+  |
|  | [图标]  输入植物或装扮名称                      [x] |    | <-- 输入植物/装扮名称
|  +-------------------------------------------------+  |
|                                                       |
+-------------------------------------------------------+
```

#### 功能详情

**1. 输入植物/装扮名称框**

- 点击输入框，输入关键词，调用接口模糊搜索出结果并展示所有的植物/装扮数据
- **布局**：

```
+-------------------------------------------------------+
|  [<-]          [图标] 单植物/装扮礼包                     | <-- AppBar
+-------------------------------------------------------+
| 													|
|  +-------------------------------------------------+  |
|  | [图标]  大                                   [x] |  | <-- 输入植物/装扮名称
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  | [图标] 大喷菇兑换码 							|  | <-- 卡片1
|  +-------------------------------------------------+  |
|  +-------------------------------------------------+  |
|  | [图标] 大力花菜兑换码   						|  | <-- 卡片2
|  +-------------------------------------------------+  |
|  +-------------------------------------------------+  |
|  | [图标] 大嘴花兑换码 							|  | <-- 卡片3
|  +-------------------------------------------------+  |
|                     ...							 |  <-- 通过接口得到的N个结果
+-------------------------------------------------------+
```

- **数据来源**：`POST /api/search/suggestions`
- 选中某一个植物/装扮后的布局为：

```
+-------------------------------------------------------+
|  [<-]          [图标] 单植物/装扮礼包                     | <-- AppBar
+-------------------------------------------------------+
| 													|
|  +-------------------------------------------------+  |
|  | [图标]  大嘴花兑换码                         [x] |  | <-- 输入植物/装扮名称
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |                 生成礼包						|  |  <-- 生成礼包卡片
|  +-------------------------------------------------+   |
|   												|
+---------------------------------------------------------+
```

- **卡片类型**：plain

**2. 生成成功**

- 点击“生成礼包”按钮后展示生成成功的界面，以下是布局：

```
+-------------------------------------------------------+
|  [<-]          [图标] 单植物/装扮礼包                     | <-- AppBar
+-------------------------------------------------------+
| 													|
|  +-------------------------------------------------+  |
|  | [图标]  大嘴花兑换码                      [x] |    | <-- 输入植物/装扮名称
|  +-------------------------------------------------+  |
|                                                       |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  ✅ 生成成功 (GeneratedResultCard)              |  |
|  |                                                 |  |
|  |  🌱 大嘴花兑换码                                 |  |
|  |                                                 |  |
|  |  ---------------- (Divider) ------------------  |  |
|  |                                                 |  |
|  |  ✨ 兑换码                                      |  |
|  |  +-------------------------------------------+  |  |<-- 生成成功卡片
|  |  |  {                                        |  |  |  
|  |  |    "encrypted_data": "..."                |  |  |
|  |  |  }                                        |  |  |
|  |  +-------------------------------------------+  |  |
|  |                                                 |  |
|  |  [Button: 📋 复制兑换码 (AccentGreen)]          |  |
|  |                                                 |  |
|  +-------------------------------------------------+  |
|                                                       |
+-------------------------------------------------------+
```


---

### 4.4 页面3：多植物界面（MultiPlant）

#### 页面标识
- **路由名称**：`/multiPlant`
- **页面标题**：选择模式
- **导航图标**：`Icons.multi_plant_outlined`

#### 页面布局
```
+-------------------------------------------------------+
|  [<-]          选择模式                                | <-- AppBar
+-------------------------------------------------------+
|                                                       |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  💡 请选择多植物礼包模式                        |  | <-- 提示卡片 
|  |                                                 |  |
|  +-------------------------------------------------+  |
|                                                       |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  🌟 20选16                                      |  |
|  |  从20个植物中选择16个                             |  | <-- 模式卡片
|  |  总数 20个   需选 16个                           |  |
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  🌟 16选8                                       |  |<-- 模式卡片
|  |  从16个植物中选择8个                            |  |
|  |  总数 16个  需选 8个                             |  |
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  🌟 10选5                                       |  |<-- 模式卡片
|  |  从10个植物中选择5个                            |  |
|  |  总数 10个  需选 5个                             |  |
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |                                                 |  |
|  |  🌟 40选3                                       |  |<-- 模式卡片
|  |  从40个植物中选择3个                            |  |
|  |  总数 40个  需选 3个                             |  |
|  +-------------------------------------------------+  |
|                                                       |
+-------------------------------------------------------+
```

#### 功能详情

**1. 20选16卡片**

- **交互**：点击该卡片后进入 20选16 界面
- **卡片类型**：plain

**2. 16选8卡片**

- **交互**：点击该卡片后进入 16选8 界面
- **卡片类型**：plain

**3. 10选5**

- **交互**：点击该卡片后进入 10选5 界面
- **卡片类型**：plain

**4. 40选3卡片**

- **交互**：点击该卡片后进入 40选3 界面

- **卡片类型**：plain

**5. 20选16/16选8/10选5/40选3卡片界面**

- 20选16/16选8/10选5/40选3界面布局为：

```
+-------------------------------------------------------+
|  [<-]          20选16                   [ 5/16 ]      | <-- AppBar (带进度指示器)
+-------------------------------------------------------+
|                                                       |
|                                                       |
|  +-------+   +-------+   +-------+   +-------+        |
|  |  Img  |   |  Img  |   |  Img  |   |  Img  |        |
|  | 豌豆  |   | 向日葵 |   | 坚果  |   | 土豆  |        |
|  +-------+   +-------+   +-------+   +-------+        | <-- 20/16/10/40 个植物卡片
|                                                       |
|  +-------+   +-------+   +-------+   +-------+        |
|  |  Img  |   |  Img  |   |  Img  |   |  Img  |        |
|  | 寒冰  |   | 火龙  |   |  ...  |   |  ...  |        |
|  +-------+   +-------+   +-------+   +-------+        |
|    (Selected)                                         |
|                                                       |
|   ... (共 20/16/10/40 个植物卡片) ...                  |
|                                                       |
|                                                       |
+-------------------------------------------------------+
| [Shadow]                                              | <-- BottomBar
|  已选择 (5/16):                                       |
|  [ (Img) 豌豆 x ] [ (Img) 寒冰 x ] ...                | <-- LazyRow (横向滚动芯片)
|                                                       |
|  💡 请继续选择，还差 11 个                             |
|                                                       |
|  [ Button: 🎁 生成礼包码 (Disabled/Gray) ]             |
+-------------------------------------------------------+
```

- 点击“生成礼包码”时构造请求规则：遍历用户已选择的植物/装扮列表，提取其 **ID**，使用**空格**将所有 ID 拼接成一个字符串作为 API 请求的 `keyword` 字段发送。

- 以上的四个模式复用一套界面显示代码，只是植物的数量和名字不同

  - 其中20个植物为：

  | 1    | 200134 | 超级机枪射手 |
  | ---- | ------ | ------------ |
  | 2    | 200143 | 球果训练家   |
  | 3    | 200058 | 牛蒡击球手   |
  | 4    | 200083 | 电鳗香蕉     |
  | 5    | 200133 | 伏僵塔黄     |
  | 6    | 200079 | 贪吃龙草     |
  | 7    | 200128 | 守卫菇       |
  | 8    | 111067 | 芦黎药师     |
  | 9    | 200009 | 荸荠兄弟     |
  | 10   | 200039 | 气流水仙花   |
  | 11   | 200066 | 曼德拉草     |
  | 12   | 111045 | 苹果迫击炮   |
  | 13   | 111070 | 桑葚爆破手   |
  | 14   | 111090 | 熊果臼炮     |
  | 15   | 200037 | 烈焰火蕨     |
  | 16   | 111085 | 食人花豌豆   |
  | 17   | 200098 | 电击钩吻     |
  | 18   | 111075 | 茄子忍者     |
  | 19   | 200051 | 激光皇冠花   |
  | 20   | 200021 | 橄榄坑       |

  - 其中16个植物为：

  | 1    | 200134 | 超级机枪射手 |
  | ---- | ------ | ------------ |
  | 2    | 200058 | 牛蒡击球手   |
  | 3    | 200083 | 电鳗香蕉     |
  | 4    | 200133 | 伏僵塔黄     |
  | 5    | 200079 | 贪吃龙草     |
  | 6    | 200128 | 守卫菇       |
  | 7    | 111067 | 芦黎药师     |
  | 8    | 200039 | 气流水仙花   |
  | 9    | 200066 | 曼德拉草     |
  | 10   | 111045 | 苹果迫击炮   |
  | 11   | 111070 | 桑葚爆破手   |
  | 12   | 111090 | 熊果臼炮     |
  | 13   | 200037 | 烈焰火蕨     |
  | 14   | 111085 | 食人花豌豆   |
  | 15   | 1045   | 瓷砖萝卜     |
  | 16   | 111047 | 逃脱树根     |

  - 其中10个植物为：

  | 1    | 200093 | 疯狂炮仗花   |
  | ---- | ------ | ------------ |
  | 2    | 200082 | 蝎尾蕉机枪手 |
  | 3    | 200073 | 剑叶龙血树   |
  | 4    | 200057 | 长枪球兰     |
  | 5    | 200074 | 斯巴达竹     |
  | 6    | 200052 | 腐尸豆荚     |
  | 7    | 200077 | 暗夜菇       |
  | 8    | 200060 | 南瓜头       |
  | 9    | 200069 | 粉丝心叶兰   |
  | 10   | 200034 | 聚能山竹     |

  - 其中40个植物为：

  | 1    | 1045   | 瓷砖萝卜     |
  | ---- | ------ | ------------ |
  | 2    | 200134 | 超级机枪射手 |
  | 3    | 200143 | 球果训练家   |
  | 4    | 200058 | 牛蒡击球手   |
  | 5    | 200083 | 电鳗香蕉     |
  | 6    | 111022 | 机枪射手     |
  | 7    | 111019 | 天使星星果   |
  | 8    | 111029 | 仙人掌       |
  | 9    | 111075 | 茄子忍者     |
  | 10   | 200034 | 聚能山竹     |
  | 11   | 200133 | 伏僵塔黄     |
  | 12   | 200128 | 守卫菇       |
  | 13   | 200079 | 贪吃龙草     |
  | 14   | 200051 | 激光皇冠花   |
  | 15   | 111045 | 苹果迫击炮   |
  | 16   | 111067 | 芦黎药师     |
  | 17   | 200009 | 荸荠兄弟     |
  | 18   | 200060 | 南瓜头       |
  | 19   | 200039 | 气流水仙花   |
  | 20   | 111016 | 猕猴桃       |
  | 21   | 111033 | 冰龙草       |
  | 22   | 200094 | 日月金银花   |
  | 23   | 200100 | 珊瑚泡泡姬   |
  | 24   | 200066 | 曼德拉草     |
  | 25   | 200024 | 地星发射井   |
  | 26   | 200139 | 海神草       |
  | 27   | 200098 | 电击钩吻     |
  | 28   | 111070 | 桑葚爆破手   |
  | 29   | 111047 | 逃脱树根     |
  | 30   | 200069 | 粉丝心叶兰   |
  | 31   | 200032 | 火鸡投手     |
  | 32   | 200021 | 橄榄坑       |
  | 33   | 111085 | 食人花豌豆   |
  | 34   | 111090 | 熊果臼炮     |
  | 35   | 200064 | 蛇妖瓶子草   |
  | 36   | 200037 | 烈焰火蕨     |
  | 37   | 200102 | 女娲蛇尾草   |
  | 38   | 111030 | 猫尾草       |
  | 39   | 200041 | 地锯草       |
  | 40   | 200061 | 鹳草击剑手   |

- 所有植物的图片我放在了 assets/images/ 目录下，并以 plant_xxx.jpg 命名

- **卡片类型**：plain

**6. 生成成功界面**

- 点击“生成礼包码”后的生成成功界面为：

```
+--------------------------------------+
|  <-          🎉 生成成功             |  <-- TopAppBar (标题栏)
+--------------------------------------+
|                                      |
|  +--------------------------------+  |
|  |               ✅               |  |
|  |        礼包码生成成功！        |  |  <-- 成功状态卡片
|  |          模式：20选16          |  |      (显示当前模式名称)
|  +--------------------------------+  |
|                                      |
|  +--------------------------------+  |
|  | ✨ 已选植物                    |  |
|  |                                |  |
|  | 1. 🌱 超级机枪射手             |  |  <-- 已选植物列表卡片
|  | 2. 🌱 球果训练家               |  |      (显示序号、图标和名称)
|  | 3. 🌱 ...                      |  |
|  +--------------------------------+  |
|                                      |
|  +--------------------------------+  |
|  | 🎁 兑换码                      |  |
|  | +----------------------------+ |  |
|  | | {                          | |  |
|  | |   "success": true,         | |  |  <-- 结果展示卡片
|  | |   "data": { ... }          | |  |      (显示服务器返回的 JSON)
|  | | }                          | |  |
|  | +----------------------------+ |  |
|  +--------------------------------+  |
|                                      |
|  [        📋 复制兑换码         ]    |  <-- 主操作按钮 
|                                      |
|  [       🔄 重新选择植物        ]    |  <-- 次要操作按钮 
|                                      |
+--------------------------------------+
```

- **卡片类型**：plain

---

### 4.5 页面4：多装扮界面（MultiCostume）

#### 页面标识
- **路由名称**：`/multiCostume`
- **页面标题**：12个装扮任意选
- **导航图标**：`Icons.multi_costume_outline`

#### 页面布局
```
+--------------------------------------------+
|  <-   👗 12装扮任意选       ( 3/12 )       |  <-- TopAppBar (紫色背景)
|                                            |      (显示标题和进度)
+--------------------------------------------+
|                                            |
|  +----------+  +----------+  +----------+  |
|  |    🖼️    |  |    🖼️   |  |    🖼️    |  |
|  |    Img   |  |     Img  |  |    Img   |  |  <-- 3列宫格布局
|  +----------+  +----------+  +----------+  |      
|                                            |
|  +----------+  +----------+  +----------+  |
|  |    🖼️    |  |    🖼️    |  |    🖼️  |  |
|  |  	Img	  |  |    Img   |  |   Img   |  |
|  +----------+  +----------+  +----------+  |
|                                            |
|  +----------+  +----------+  +----------+  |
|  |    🖼️   |  |    🖼️    |  |    🖼️    |  |
|  |  	Img  |   |   Img    |  |    Img   |  |
|  +----------+  +----------+  +----------+  |
|                                            |
|      ... (共12个装扮，向下滚动) ...          |
|                                            |
+--------------------------------------------+
| 已选装扮 (3/12):                            |  <-- 底部栏  
| [🖼️ 激光.. ✖] [🖼️ 仙人.. ✖] ...            |  <-- 横向滚动已选列表  
|                                              |
| ✨ 已选择 3 个装扮，可以生成...               |  <-- 状态提示文本
|                                             |
| [      👗 生成装扮礼包码       ]             |  <-- 生成卡片
+----------------------------------------------+
```

#### 功能详情

**1. 这12 个装扮编号及其名字为**：

| 1    | 30010082 | 双胞向日葵超级装扮 |
| ---- | -------- | ------------------ |
| 2    | 30010394 | 激光豆魔龙超级装扮 |
| 3    | 30010451 | 瓷砖萝卜超级装扮   |
| 4    | 30010703 | 大嘴花超级装扮     |
| 5    | 31110224 | 机枪射手超级装扮   |
| 6    | 31110292 | 仙人掌超级装扮     |
| 7    | 31110303 | 猫尾草怀旧超级装扮 |
| 8    | 31110672 | 芦藜药师超级装扮   |
| 9    | 31110704 | 桑葚爆破手超级装扮 |
| 10   | 32000344 | 聚能山竹超级装扮   |
| 11   | 32000792 | 贪吃龙草超级装扮   |
| 12   | 32000832 | 电鳗香蕉超级装扮   |

**2. 这 12 个装扮的图片我已经放在 `assets/images/` 目录下，并以 costume_xxx.jpg 命名**

**3. 点击“生成礼包码”后的生成成功的界面布局为：**

```
+--------------------------------------+
|  <-          🎉 生成成功             |  <-- TopAppBar  
+--------------------------------------+
|                                      |
|  +--------------------------------+  |
|  |               👗               |  |
|  |       装扮礼包码生成成功！     |  |  <-- 成功状态卡片 
|  |     已选择 3 个超级装扮        |  |
|  +--------------------------------+  |
|                                      |
|  +--------------------------------+  |
|  | ✨ 选中的装扮:                 |  |
|  |                                |  |
|  | 1. 🖼️ 激光豆魔龙超级装扮       |  |  <-- 已选装扮列表卡片
|  | 2. 🖼️ 仙人掌超级装扮           |  |      (显示序号、小图和名称)
|  | 3. 🖼️ 桑葚爆破手超级装扮       |  |
|  +--------------------------------+  |
|                                      |
|  +--------------------------------+  |
|  | 🎁 装扮礼包码:                 |  |
|  | +----------------------------+ |  |
|  | | {                          | |  |
|  | |   "success": true,         | |  |  <-- 结果展示卡片
|  | |   "data": { ... }          | |  |      (显示服务器返回的 JSON)
|  | | }                          | |  |
|  | +----------------------------+ |  |
|  |                              | |  |
|  | [      📋 复制礼包码       ] | |  |  <-- 卡片内的复制按钮 
|  |                              | |  |
|  +--------------------------------+  |
|                                      |
|  [      ⬅️ 返回修改装扮       ]      |  <-- 底部操作按钮 (描边样式)
|                                      |
|  [        🔄 重新开始         ]      |  <-- 底部操作按钮 (描边样式)
|                                      |
+--------------------------------------+
```

- **卡片类型**：plain

---

### 4.6 登录页面（Login）

#### 页面标识
- **路由名称**：`/login`
- **页面标题**：无（全屏页面）

#### 页面布局
```
+--------------------------------------+
|                                      |
|                                      |
|           [   LOGO   ]               |  <-- Image (100.dp)
|                                      |
|                                      |
|           欢迎使用                   | 
|                                      |
|      请输入您的卡密激活应用          |  
|                                      |
|                                      |
|  +--------------------------------+  |
|  | 卡密                           |  |
|  | 请输入卡密，例如：ABCD...      |  |  <-- 输入框
|  +--------------------------------+  |
|                                      |
|  [  ⚠️ 错误提示 (仅出错时显示)  ]    |  <-- Error Card (红色背景)
|                                      |
|  [           激  活           ]      |  <-- Button (蓝色背景, 50.dp)
|                                      |
|                                      |
|       如遇问题，请联系开发者         |  <-- Footer Text (12.sp, Gray)
|                                      |
|                                      |
+--------------------------------------+
```

#### 功能详情

**1. Logo**

- 使用 android\app\src\main\res\drawable 目录下的 `ic_launcher.jpg` 图片

**2. 输入框**

- 点击输入框，显示蓝色描边，“卡密”二字嵌在描边上面

**3. 激活按钮**

- **点击行为**：
  1. 调用接口：`POST /api/activate`
  2. 成功：
     - 保存 Token 到本地（使用 flutter_secure_storage）
     - 跳转到主页面
  3. 失败：
     - 输入框下方显示红色错误文字
     - 错误信息："卡密不存在"、“卡密已绑定其他设备”等

#### 交互行为
- **启动检查**：
  - APP 启动时检查本地是否有 Token
  - 有 Token：验证 Token 是否有效
    - 有效：直接进入主界面
    - 无效：跳转登录页
  - 无 Token：跳转登录页

---

## 5. 技术选型

### 5.1 核心框架
- **Flutter 版本**：3.16.0 或更高
- **Dart 版本**：3.2.0 或更高
- **最低 Android 版本**：Android 5.0 (API 21)
- **最低 iOS 版本**：iOS 12.0

### 5.2 状态管理
- **方案**：Riverpod 2.x
- **理由**：
  - 支持 Material You 动态主题
  - 状态管理清晰，易于测试
  - 适合中型项目
  - 社区活跃，文档完善

### 5.3 网络请求
- **HTTP 库**：dio (^5.4.0)
- **功能**：
  - 拦截器（自动添加 Token）
  - 错误处理
  - 请求取消
  - 超时设置

### 5.4 本地存储
- **Token 存储**：flutter_secure_storage (^9.0.0)
  - 加密存储 Token
  - 安全性高
- **设置存储**：shared_preferences (^2.2.2)
  - 存储主题设置
  - 存储用户偏好

### 5.5 UI 组件
- **Material Design 3**：Flutter 内置
- **图标**：Material Icons（Flutter 内置）
- **加载动画**：Flutter 内置 CircularProgressIndicator

### 5.6 工具库
- **日期时间**：intl (^0.19.0)
- **JSON 序列化**：json_annotation + json_serializable
- **路由管理**：go_router (^13.0.0)

---

## 6. 技术架构

### 6.1 项目结构

```
lib/
├── main.dart                        # 应用入口 (初始化服务、运行 App)
├── app.dart                         # 应用根组件 
│
├── config/                          # 全局配置
│   ├── theme.dart                   # 主题配置  
│   ├── routes.dart                  # 路由定义  
│   ├── constants.dart               # 常量 (API URL, 超时时间等)
│    
│
├── models/                          # 数据模型  
│   ├── license_request.dart         # 激活请求模型
│   ├── license_response.dart        # 激活响应模型
│   ├── search_request.dart          # 查询请求模型
│   ├── search_response.dart         # 查询响应模型
│   ├── plant_data.dart              # 单植物礼包数据
│   ├── plant_pools.dart             # 多植物池配置
│   └── device_info.dart             # 设备信息模型
│
├── providers/                       # 状态管理 (Riverpod / Provider / Bloc)
│   ├── auth_provider.dart           # 认证状态  
│   ├── simple_plant_provider.dart   # 单植物生成状态  
│   ├── multi_plant_provider.dart    # 多植物生成状态  
│   └── multi_costume_provider.dart  # 多装扮生成状态  
│
├── services/                        # 业务服务层 
│   ├── api/                         # 网络层
│   │   ├── api_client.dart          # Dio/Http 客户端配置  
│   │   ├── auth_service.dart        # 认证 API 
│   │   └── search_service.dart      # 查询 API 
│   │
│   ├── local/                       # 本地存储
│       ├── storage_service.dart     # SharedPreferences 封装  
│       └── secure_storage.dart      # 安全存储  
│  
│
├── screens/                         # 页面  
│   ├── splash/                      # 闪屏页
│   │   └── splash_screen.dart
│   │
│   ├── auth/                        # 认证模块
│   │   ├── login_screen.dart        # 登录/激活界面
│   │   └── widgets/                 # 登录专用组件
│   │
│   ├── home/                        # 主界面 (导航容器)
│   │   └── main_screen.dart
│   │
│   ├── single_plant/                # 单植物/装扮生成器
│   │   ├── single_plant_screen.dart # 主列表界面
│   │   ├── generator_screen.dart    # 生成结果界面
│   │   └── widgets/
│   │
│   ├── multi_plant/                 # 多植物生成器
│   │   ├── mode_selection_screen.dart # 模式选择
│   │   ├── plant_selection_screen.dart# 植物选择
│   │   ├── result_screen.dart       # 结果展示
│   │   └── widgets/
│   │
│   └── multi_costume/               # 多装扮生成器
│       ├── costume_main_screen.dart
│       └── widgets/
│
├── widgets/                         # 通用 UI 组件
│   ├── custom_button.dart           # 统一风格按钮
│   ├── loading_overlay.dart         # 加载遮罩
│   ├── error_card.dart              # 错误提示卡片
│   └── copy_dialog.dart             # 复制成功提示
│
└── utils/                           # 工具类
    ├── device_utils.dart            # 设备 ID 获取 
    ├── security_utils.dart          # 加密/签名工具  
    ├── validators.dart              # 输入验证
    └── extensions.dart              # 扩展方法
```

### 6.2 数据流架构

```
UI Layer (Screens/Widgets)
    ↓ 读取状态
Providers (Riverpod)
    ↓ 调用服务
Services (API/Storage)
    ↓ 网络请求
Backend API
```

### 6.3 认证流程

```
1. APP 启动
   ↓
2. 检查本地 Token (StorageService)
   ↓
3. 有 Token？
   ├─ 是 → 验证 Token 有效性
   │        ├─ 有效 → 进入主界面
   │        └─ 无效 → 跳转登录页
   └─ 否 → 跳转登录页
   ↓
4. 用户登录
   ↓
5. 保存 Token
   ↓
6. 进入主界面
```

---

## 7. 后端接口说明

### 7.1 基础信息
- **Base URL**：开发环境下，Android 模拟器请使用 `http://10.0.2.2:3000/api`，真机调试请使用电脑的局域网 IP（如 `http://192.168.1.x:3000/api`）。生产环境请替换为实际服务器域名。
- **认证方式**：JWT Token（Bearer Token）
- **请求头**：
  ```
  Content-Type: application/json
  Authorization: Bearer <token>
  ```

### 7.2 登录接口

#### 接口
```
POST /api/activate
```
**请求体**：
```json
{
  "license_key": "你的卡密字符串",
  "device_id": "设备唯一标识符"
}
```
**响应**：
```json
{
  "success": true,
  "message": "激活成功",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresAt": 1700086400
}
```

### 7.3 搜索建议接口

#### 接口
```
POST /api/search/suggestions
```
**请求体**：

```json
{
  "keyword": "大力",
  "token": "eyJhbGciOiJIUzI1Ni..."
}
```

**响应**：

```json
{

  "success": true,
  "data": [
    "大力花菜",
    "大力花菜兑换码"
  ]
}
```

### 7.4 查询兑换码接口

#### 接口
```
POST /api/search
```
**请求体**：
```json
{
  "keyword": "大力花菜兑换码",  // 或多植物编号 "1045 200134 111067"
  "token": "eyJhbGciOiJIUzI1Ni..." // 激活时获取的 Token
}
```
**响应**：
```json
{
  "success": true,
  "data": {
    "search_key": "大力花菜兑换码",
    "code_type": "单植物-单装扮",
    "encrypted_data": {
      "i": "V330",
      "r": 0,
      "e": "9D9ICLXK-16ceGtlRlji8m9k..."
    }
  },
  "newToken": "...",       // (可选) 快过期时返回的新 Token
  "expiresAt": 1700172800  // (可选) 新 Token 过期时间
}
```

---

## 8. 开发规范

### 8.1 代码规范

#### 命名规范
- **文件名**：小写下划线（snake_case）
  - 示例：`dashboard_screen.dart`、`api_service.dart`
- **类名**：大驼峰（PascalCase）
  - 示例：`DashboardScreen`、`ApiService`
- **变量/函数名**：小驼峰（camelCase）
  - 示例：`userName`、`fetchLicenses()`
- **常量**：大写下划线（UPPER_SNAKE_CASE）
  - 示例：`API_BASE_URL`、`TOKEN_KEY`

#### 注释规范
- **类注释**：说明类的用途
- **函数注释**：说明参数、返回值、功能
- **复杂逻辑**：添加行内注释

#### 代码组织
- **导入顺序**：
  1. Dart SDK
  2. Flutter SDK
  3. 第三方包
  4. 项目内部文件
- **每个文件**：只包含一个主要类
- **Widget 拆分**：超过 200 行的 Widget 应拆分

### 8.2 错误处理规范

#### 网络错误
- **场景 A：登录失败**
  - 卡密输入错误：输入框下方显示红色错误文字
  - 网络断开：弹出 Dialog，提示"网络连接失败，请检查网络设置"
  
- **场景 B：Token 过期**
  - 401 错误：弹出 Dialog，提示"登录已过期，请重新登录"
  - 自动跳转到登录页
  
- **场景 C：网络断开**
  - 无网络连接：弹出 Dialog，提示"网络连接失败"
  - 提供"重试"按钮
  
- **场景 D：服务器错误**
  - 500 错误：弹出 Dialog，提示"服务器错误，请稍后重试"

#### Dialog 样式
- **标题**：错误类型（如"网络错误"）
- **内容**：错误描述
- **按钮**：
  - 单按钮："确定"
  - 双按钮："取消" + "重试"

### 8.3 操作成功反馈

#### 成功动画
- **类型**：勾选动画（Checkmark Animation）
- **实现方式**：
  - 使用 AnimatedContainer
  - 或使用 Lottie 动画（可选）
- **显示时长**：1.5 秒
- **颜色**：绿色

#### SnackBar（可选）
- **位置**：屏幕底部
- **内容**：操作成功提示（如"添加成功"）
- **颜色**：绿色背景
- **显示时长**：2 秒

### 8.4 空状态规范

#### 空状态插图
- **使用**：Material Icons 的大图标
- **大小**：64dp
- **颜色**：灰色（onSurface.withOpacity(0.3)）

#### 空状态文字
- **内容**：
  - 输入卡密："暂无卡密数据"
  - 查询兑换码："暂无此兑换码"
- **字体大小**：16sp
- **颜色**：灰色（onSurface.withOpacity(0.6)）

### 8.5 性能优化规范

#### 列表优化
- **使用**：ListView.builder（懒加载）
- **避免**：ListView（一次性加载所有）

#### 图片缓存
- **使用**：cached_network_image
- **缓存策略**：内存缓存 + 磁盘缓存

#### 状态管理
- **避免**：不必要的 rebuild
- **使用**：Riverpod 的 select 方法

#### 网络请求
- **取消请求**：页面销毁时取消未完成的请求
- **请求合并**：相同请求在短时间内只发送一次

---

## 9. 实现细节

### 9.1 Superellipse 圆角实现

使用 `ClipRRect` 或自定义 `ShapeBorder`：

```dart
// 方案 A：使用 ClipRRect（简单）
ClipRRect(
  borderRadius: BorderRadius.circular(16),
  child: Container(...)
)

// 方案 B：自定义 ShapeBorder（更精确）
// 需要实现 SuperellipseShape 类
```

### 9.2 CommonCard 组件规范

**Props**：
- `type`：CardType.plain 或 CardType.filled
- `child`：Widget
- `padding`：EdgeInsets（默认 16dp）
- `margin`：EdgeInsets（默认 12dp）
- `onTap`：VoidCallback?（可选）

**样式**：
- **plain 类型**：
  - 背景：透明
  - 边框：1dp，颜色为 outline
  - 阴影：无
- **filled 类型**：
  - 背景：surfaceVariant
  - 边框：无
  - 阴影：elevation 1

### 9.3 设备 ID 生成策略

为了与 Android/iOS 版本保持一致，Device ID 应组合 `Android ID/IOS ID`、`Brand` 和 `Model`，并进行 SHA256 加密截取前 32 位。需引入 `device_info_plus` 和 `crypto` 库来实现。注意这里要严格限制“一台设备只能激活一次”，在第一次生成 ID 后，将其存储在 **Keychain** (iOS) 或 **EncryptedSharedPreferences** (Android) 中（使用 `flutter_secure_storage` 即可实现）

### 9.4 **复制兑换码**

点击复制按钮时，仅复制 `encrypted_data` 字段的值

---

## 10. 依赖清单

### 10.1 pubspec.yaml

```yaml
dependencies:
  flutter:
    sdk: flutter
  
  # 状态管理
  flutter_riverpod: ^2.4.9
  riverpod_annotation: ^2.3.3
  
  # 网络请求
  dio: ^5.4.0
  
  # 本地存储
  flutter_secure_storage: ^9.0.0
  shared_preferences: ^2.2.2
  
  # 路由
  go_router: ^13.0.0
  
  # 工具
  intl: ^0.19.0
  json_annotation: ^4.8.1
  
  # Material You 配色
  material_color_utilities: ^0.8.0
  
  # 设备ID
  device_info_plus: ^9.0.0
  crypto: ^3.0.3

dev_dependencies:
  flutter_test:
    sdk: flutter
  
  # 代码生成
  build_runner: ^2.4.7
  json_serializable: ^6.7.1
  riverpod_generator: ^2.3.9
  
  # 代码规范
  flutter_lints: ^3.0.1
  
flutter:
  uses-material-design: true
  
  assets:
    - assets/images/
```

---

## 11. 注意事项

### 11.1 后端依赖
- **接口地址**：开发时使用 `http://localhost:3000`，需要根据实际情况修改

### 11.2 平台差异
- **Android**：需要在 `AndroidManifest.xml` 中添加网络权限
- **iOS**：需要在 `Info.plist` 中配置 HTTP 请求权限
- **Web**：需要配置 CORS

### 11.3 安全性
- **Token 存储**：使用 flutter_secure_storage 加密存储
- **HTTPS**：生产环境必须使用 HTTPS
- **证书验证**：不要禁用证书验证

---

## 12. 总结

本文档详细描述了卡密监控系统 Flutter APP 的所有设计和实现细节，包括：

1. ✅ 完整的 UI/UX 设计规范
2. ✅ 4个主页面的详细设计
3. ✅ 技术选型和架构设计
4. ✅ 后端接口说明
5. ✅ 开发规范和实现细节
6. ✅ 依赖清单和检查清单

开发者应严格按照本指南进行开发，确保实现符合设计要求。

---

**文档版本**：v1.0.0  
**最后更新**：2025-11-19  
**维护者**：Plant Team
